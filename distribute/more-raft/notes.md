# 领导权禅让

有的时候leader必须下台，比如他可能出现重新启动，或者已经从集群中删除

在某些情况下，一台或多台服务器可能比其他的服务器更适合领导集群。比如数据中心中的服务器，用来减少客户端和领导者之间的延迟

过程如下

* 当前leader停止接受客户请求
* 当前leader完整更新目标服务器的日志以使其与自己的日志匹配
* 当前leader将timeoutNow请求发送到目标服务器，目标服务器将开始新的选举

# 集群成员更改

和论文中不同的是，这里的集群更改是一个更加简单的算法

核心思路就是禁止会导致多数成员不相交的成员更改。所以这种更改方法一次只能从集群中添加或者删除一个服务器

![20220314151657](https://picsheep.oss-cn-beijing.aliyuncs.com/pic/20220314151657.png)

当领导者收到从当前配置（Cold）中添加或删除服务器的请求时，它将新配置（Cnew）作为一个条目添加到其日志中，并使用常规的 Raft 机制复制该条目。新配置一旦添加到服务器的日志中，就会在这个服务器上生效：Cnew 条目被复制到 Cnew 指定的服务器上，而大部分服务器的新配置生效被用于确定 Cnew 条目的提交。这意味着服务器不会等待配置条目被提交，并且每个服务器总是使用在其日志中找到的最新配置。

一旦提交了 Cnew 条目，配置更改就完成了。此时，领导者知道大多数的 Cnew 指定的服务器已经采用了 Cnew。它还知道，没有收到 Cnew 条目的任意服务器都不能再构成集群的大多数，没有收到 Cnew 的服务器也不能再当选为领导者。Cnew 的提交让三件事得以继续:

* 领导可以确认配置更改的成功完成。
* 如果配置更改删除了服务器，则可以关闭该服务器。
* 可以启动进一步的配置更改。在此之前，重叠的配置更改可能会降级为不安全的情况